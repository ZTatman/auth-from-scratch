<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Architecture & Flow</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        h1, h2 {
            text-align: center;
            color: #2c3e50;
        }
        .diagram-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }
        .mermaid {
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body>
    <h1>Application Overview</h1>

    <div class="diagram-container">
        <h2>System Architecture</h2>
        <div class="mermaid">
graph TD
    subgraph "Client (Vite + React)"
        UI[Components (AuthPage)]
        Context[UserContext (State)]
        API[API Layer (fetch)]
        LocalStorage[(LocalStorage)]
    end

    subgraph "Shared"
        Types[Shared Types & Zod Schemas]
    end

    subgraph "Server (Express + Node.js)"
        Router[Express Router]
        AuthRoute[Auth Routes /api/auth]
        Middleware[Auth Middleware]
        Prisma[Prisma ORM]
    end

    subgraph "Database"
        Postgres[(PostgreSQL)]
    end

    %% Connections
    UI -->|Uses| Context
    UI -->|Calls| API
    API -->|HTTP Request| Router
    Router -->|Routes to| AuthRoute
    AuthRoute -->|Validates with| Types
    UI -->|Validates with| Types
    AuthRoute -->|Queries| Prisma
    Prisma -->|SQL| Postgres
    Context -->|Persists Token| LocalStorage
        </div>
    </div>

    <div class="diagram-container">
        <h2>Authentication Flow (Login)</h2>
        <div class="mermaid">
sequenceDiagram
    participant User
    participant Client as Client (React)
    participant Server as Server (Express)
    participant DB as Database (Prisma)

    User->>Client: Enters Username/Password
    Client->>Server: POST /api/login
    Note over Client,Server: Body: { username, password }
    
    Server->>Server: Validate Input (Zod)
    Server->>DB: Find User by Username
    DB-->>Server: User Record (Hash)
    
    Server->>Server: bcrypt.compare(password, hash)
    
    alt Invalid Credentials
        Server-->>Client: 401 Unauthorized
        Client-->>User: Show Error Message
    else Valid Credentials
        Server->>Server: jwt.sign({ userId }, Secret)
        Server-->>Client: 200 OK { token, user }
        
        Client->>Client: UserContext.login()
        Client->>Client: localStorage.setItem('auth_token', token)
        Client-->>User: Redirect / Update UI
    end
        </div>
    </div>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
    </script>
</body>
</html>
